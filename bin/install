#!/usr/bin/env node

const path = require('path');
const Validate = require('git-validate');

if (module.filename.endsWith('node_modules/developer-tools/bin/install')) {
	// copy the base install files if they don't exist
	Validate.copy('../resources/.depcheckrc', './.depcheckrc');
	Validate.copy('../resources/.eslintrc', './.eslintrc');
	Validate.copy('../resources/.eslintignore', './.eslintignore');
	Validate.copy('../resources/test/.eslintrc', './test/.eslintrc');

	// update package.json with scripts if they don't exist
	Validate.installScript('coverage-report', '"$(npm bin)/istanbul-coverage-report"');
	Validate.installScript('coverage', 'npm run coverage-report && open ./coverage/lcov-report/index.html');
	Validate.installScript('coverage-badge', '"$(npm bin)/istanbul-cobertura-badger" -e 95 -g 85 -b "${PWD##*/}"');
	Validate.installScript('lint', '"$(npm bin)/eslint" .');
	Validate.installScript('validate', '"$(npm bin)/module-validator"');
	Validate.installScript('depcheck', '"$(npm bin)/dependency-checker"');

	// run these hooks from the git pre-commit hook
	Validate.configureHook('pre-commit', ['lint', 'validate', 'depcheck']);
}
